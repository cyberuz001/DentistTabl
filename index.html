<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vazifalar Boshqaruvi</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">

    <!-- Malumot qo'shish oynasi -->
    <div class="container mx-auto mt-10 p-4 bg-white rounded shadow">
        <h1 class="text-xl font-bold mb-4">Malumot Qo'shish</h1>
        <form id="task-form">
            <div class="mb-4">
                <label for="name" class="block text-gray-700">Ism</label>
                <input type="text" id="name" name="name" class="w-full p-2 border border-gray-300 rounded" required>
            </div>
            <div class="mb-4">
                <label for="family" class="block text-gray-700">Familiya</label>
                <input type="text" id="family" name="family" class="w-full p-2 border border-gray-300 rounded" required>
            </div>
            <div class="mb-4">
                <label for="formula" class="block text-gray-700">Formula Raqami</label>
                <input type="text" id="formula" name="formula" class="w-full p-2 border border-gray-300 rounded" required>
            </div>
            <div class="mb-4">
                <label for="task-type" class="block text-sm font-medium text-gray-700">Tishning turi</label>
                <select id="task-type" name="type" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-2" required>
                    <option value="" disabled selected>Tishni tanlang</option>
                    <option value="Sirkonniy">Sirkonniy</option>
                    <option value="Metalokeramika">Metalokeramika</option>
                    <option value="Vinir">Vinir</option>
                    <option value="Implant">Implant</option>
                    <option value="Shtif">Shtif</option>
                    <option value="Silniy litoy">Silniy litoy</option>
                </select>
            </div>
            <div class="mb-4">
                <label for="color" class="block text-gray-700">Rangi</label>
                <input type="text" id="color" name="color" class="w-full p-2 border border-gray-300 rounded" required>
            </div>
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Qo'shish</button>
        </form>
    </div>

    <!-- Qidiruv inputi -->
    <div class="container mx-auto mt-10 p-4 bg-white rounded shadow">
        <h1 class="text-xl font-bold mb-4">Qidirish</h1>
        <input type="text" id="search-input" class="w-full p-2 border border-gray-300 rounded" placeholder="Qidiruv...">
    </div>

    <!-- Bajarilmagan ishlar -->
    <div id="incomplete-container" class="container mx-auto mt-10 p-4 bg-white rounded shadow">
        <h2 class="text-lg font-bold mb-4">Bajarilmagan Ishlar</h2>
        <div class="overflow-x-auto">
            <table id="incomplete-tasks" class="w-full border border-gray-300 rounded">
                <thead>
                    <tr>
                        <th class="py-2 px-4 border-b">Ism</th>
                        <th class="py-2 px-4 border-b">Familiya</th>
                        <th class="py-2 px-4 border-b">Formula Raqami</th>
                        <th class="py-2 px-4 border-b">Tishning turi</th>
                        <th class="py-2 px-4 border-b">Rangi</th>
                        <th class="py-2 px-4 border-b">Harakat</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Bajarilmagan ishlar shu yerda ko'rsatiladi -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Bajarilgan ishlar -->
    <div id="complete-container" class="container mx-auto mt-10 p-4 bg-white rounded shadow">
        <h2 class="text-lg font-bold mb-4">Bajarilgan Ishlar</h2>
        <div class="overflow-x-auto">
            <table id="complete-tasks" class="w-full border border-gray-300 rounded">
                <thead>
                    <tr>
                        <th class="py-2 px-4 border-b">Ism</th>
                        <th class="py-2 px-4 border-b">Familiya</th>
                        <th class="py-2 px-4 border-b">Formula Raqami</th>
                        <th class="py-2 px-4 border-b">Tishning turi</th>
                        <th class="py-2 px-4 border-b">Rangi</th>
                        <th class="py-2 px-4 border-b">Harakat</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Bajarilgan ishlar shu yerda ko'rsatiladi -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const incompleteTasksTable = document.getElementById('incomplete-tasks').querySelector('tbody');
        const completeTasksTable = document.getElementById('complete-tasks').querySelector('tbody');

        function fetchTasks(status) {
            fetch(`http://127.0.0.1:8000/tasks/${status}`)
                .then(response => response.json())
                .then(tasks => {
                    const table = status === 'incomplete' ? incompleteTasksTable : completeTasksTable;
                    table.innerHTML = '';

                    tasks.forEach(task => {
                        const row = document.createElement('tr');

                        row.innerHTML = `
                            <td class="py-2 px-4 border-b">${task.name}</td>
                            <td class="py-2 px-4 border-b">${task.family}</td>
                            <td class="py-2 px-4 border-b">${task.formula}</td>
                            <td class="py-2 px-4 border-b">${task.type}</td>
                            <td class="py-2 px-4 border-b">${task.color}</td>
                            <td class="py-2 px-4 border-b">
                                ${status === 'incomplete' ? `<button class="bg-blue-500 text-white px-2 py-2 rounded" onclick="completeTask('${task.name}')">Bajarildi</button>` : ''}
                                <button class="bg-red-600 text-white px-2 py-2 rounded" onclick="deleteTask('${task.name}', '${status}')">O'chirish</button>
                            </td>
                        `;

                        table.appendChild(row);
                    });
                })
                .catch(error => console.error('Xatolik:', error));
        }

        function addTask(task) {
            fetch('http://127.0.0.1:8000/tasks/incomplete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ tasks: [task] })
            })
            .then(response => response.text())  // JSON emas, matn javobni o'qish
            .then(data => {
                console.log('Muvaffaqiyatli qo\'shildi:', data);
                fetchTasks('incomplete');  // Qo'shishdan so'ng qayta yuklash
            })
            .catch(error => console.error('Xatolik:', error));
        }

        function completeTask(name) {
            fetch('http://127.0.0.1:8000/tasks/incomplete', {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, status: 'complete' })
            })
            .then(response => response.text())  // JSON emas, matn javobni o'qish
            .then(data => {
                console.log('Muvaffaqiyatli bajarildi:', data);
                fetchTasks('incomplete');
                fetchTasks('complete');
            })
            .catch(error => console.error('Xatolik:', error));
        }

        function deleteTask(name, status) {
            fetch(`http://127.0.0.1:8000/tasks/${status}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name })
            })
            .then(response => response.text())  // JSON emas, matn javobni o'qish
            .then(data => {
                console.log('Muvaffaqiyatli o\'chirildi:', data);
                fetchTasks(status);
            })
            .catch(error => console.error('Xatolik:', error));
        }

        document.getElementById('task-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const task = {
                name: document.getElementById('name').value,
                family: document.getElementById('family').value,
                formula: document.getElementById('formula').value,
                type: document.getElementById('task-type').value,
                color: document.getElementById('color').value,
            };

            addTask(task);
            this.reset();
        });

        document.getElementById('search-input').addEventListener('input', function(event) {
            const searchText = event.target.value.toLowerCase();
            const allTasks = [...incompleteTasksTable.rows, ...completeTasksTable.rows];

            allTasks.forEach(row => {
                const taskText = row.innerText.toLowerCase();
                row.style.display = taskText.includes(searchText) ? '' : 'none';
            });
        });

        fetchTasks('incomplete');
        fetchTasks('complete');
    </script>

</body>
</html>
